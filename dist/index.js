!function(){function e(e){return new Promise((s,t)=>{var i=e.configuration.ServiceURL+"businessinformation/businesses/v1/search",n="Bearer "+e.authToken.access_token,r={name:e.properties.name,city:e.properties.city,state:e.properties.state,subcode:e.properties.subcode},a=JSON.stringify(r),o=new XMLHttpRequest;o.onreadystatechange=function(){try{if(4!==o.readyState)return;if(200!==o.status)throw new Error("Failed with status code "+o.status+" "+o.responseText);s({results:JSON.parse(o.responseText),obj:e})}catch(e){t(e)}},o.open("POST",i),o.setRequestHeader("Content-Type","application/json"),o.setRequestHeader("Authorization",n),o.send(a)})}function s(e){return new Promise((s,t)=>{if(null==e.results.results[0].bin)throw new Error("No business found. Try modifying business name, city and/or state and search again.");var i=e.obj.configuration.ServiceURL+"businessinformation/businesses/v1/scores",n="Bearer "+e.obj.authToken.access_token,r={bin:e.results.results[0].bin,subcode:e.obj.properties.subcode,commercialScore:!0},a=JSON.stringify(r),o=new XMLHttpRequest;o.onreadystatechange=function(){try{if(4!==o.readyState)return;if(200!==o.status)throw new Error("Failed with status code "+o.status+" "+o.responseText);var e=JSON.parse(o.responseText);postResult({bin:e.results.businessHeader.bin,businessName:e.results.businessHeader.businessName,phone:e.results.businessHeader.phone,street:e.results.businessHeader.address.street,city:e.results.businessHeader.address.city,state:e.results.businessHeader.address.state,zip:e.results.businessHeader.address.zip,zipExtension:e.results.businessHeader.address.zipExtension,score:e.results.commercialScore.score,percentileRanking:e.results.commercialScore.percentileRanking,recommendedCreditLimitAmount:e.results.commercialScore.recommendedCreditLimitAmount,riskCode:e.results.commercialScore.riskClass.code,riskDefinition:e.results.commercialScore.riskClass.definition,highUtilizationAccounts:e.results.commercialScoreFactors[0].code,seriouslyDelinquentAccounts:e.results.commercialScoreFactors[1].code,activeCommercialAccounts:e.results.commercialScoreFactors[2].code,delinquentCommercialAccounts:e.results.commercialScoreFactors[3].code}),s()}catch(e){t(e)}},o.open("POST",i),o.setRequestHeader("Content-Type","application/json"),o.setRequestHeader("Authorization",n),o.send(a)})}metadata={systemName:"[Immersion] - Vendor Onboarding - Experian Business Search",displayName:"Vendor Onboarding - Experian Business Search",description:"Perform Experian search on a business and get a suggested credit level.",configuration:{ServiceURL:{displayName:"Experian Search URL",type:"string",value:"https://sandbox-us-api.experian.com/"}}},ondescribe=async function({configuration:e}){postSchema({objects:{ExperianBusinessSearch:{displayName:"Experian Business Search",description:"Experian Business Search",properties:{client_id:{displayName:"client_id",type:"string"},client_secret:{displayName:"client_secret",type:"string"},username:{displayName:"username",type:"string"},password:{displayName:"password",type:"string"},issued_at:{displayName:"issued_at",type:"string"},expires_in:{displayName:"expires_in",type:"string"},token_type:{displayName:"token_type",type:"string"},access_token:{displayName:"access_token",type:"string"},refresh_token:{displayName:"refresh_token",type:"string"},accessToken:{displayName:"accessToken",type:"string"},name:{displayName:"name",type:"string"},city:{displayName:"city",type:"string"},state:{displayName:"state",type:"string"},subcode:{displayName:"subcode",type:"string"},bin:{displayName:"bin",type:"string"},businessName:{displayName:"businessName",type:"string"},phone:{displayName:"phone",type:"string"},street:{displayName:"street",type:"string"},zip:{displayName:"zip",type:"string"},zipExtension:{displayName:"zipExtension",type:"string"},score:{displayName:"score",type:"string"},percentileRanking:{displayName:"percentileRanking",type:"string"},recommendedCreditLimitAmount:{displayName:"recommendedCreditLimitAmount",type:"string"},riskCode:{displayName:"riskCode",type:"string"},riskDefinition:{displayName:"riskDefinition",type:"string"},highUtilizationAccounts:{displayName:"highUtilizationAccounts",type:"string"},seriouslyDelinquentAccounts:{displayName:"seriouslyDelinquentAccounts",type:"string"},activeCommercialAccounts:{displayName:"activeCommercialAccounts",type:"string"},delinquentCommercialAccounts:{displayName:"delinquentCommercialAccounts",type:"string"}},methods:{businessSearch:{displayName:"Perform Business Search",type:"execute",inputs:["username","password","client_id","client_secret","name","city","state","subcode"],outputs:["bin","businessName","phone","street","city","state","zip","zipExtension","score","percentileRanking","recommendedCreditLimitAmount","riskCode","riskDefinition","highUtilizationAccounts","seriouslyDelinquentAccounts","activeCommercialAccounts","delinquentCommercialAccounts"]}}}}})},onexecute=async function({objectName:t,methodName:i,parameters:n,properties:r,configuration:a}){switch(t){case"ExperianBusinessSearch":await async function(t,i,n,r){switch(t){case"businessSearch":await function(t,i,n){return new Promise((t,r)=>{try{(function(e,s){return new Promise((t,i)=>{var n=s.ServiceURL+"oauth2/v1/token",r={username:e.username,password:e.password,client_id:e.client_id,client_secret:e.client_secret},a=JSON.stringify(r),o=new XMLHttpRequest;o.onreadystatechange=function(){try{if(4!==o.readyState)return;if(200!==o.status)throw new Error("Failed with status code "+o.status+" "+o.responseText);t({properties:e,configuration:s,authToken:JSON.parse(o.responseText)})}catch(e){i(e)}},o.open("POST",n),o.setRequestHeader("Content-Type","application/json"),o.send(a)})})(i,n).then(e).then(s),t()}catch(e){r(e)}})}(0,n,r);break;default:throw new Error("The method "+t+" is not supported.")}}(i,0,r,a);break;default:throw new Error("The object "+t+" is not supported.")}}}();
//# sourceMappingURL=index.js.map
